
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
        
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>è®¡ç®—æœºç³»ç»ŸII - Azur3lily</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ii" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Azur3lily" class="md-header__button md-logo" aria-label="Azur3lily" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Azur3lily
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              è®¡ç®—æœºç³»ç»ŸII
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Azur3lily" class="md-nav__button md-logo" aria-label="Azur3lily" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Azur3lily
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    é¦–é¡µ
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../photography/docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    é’å¿—æ‘„å½±
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="ii">è®¡ç®—æœºç³»ç»ŸII</h1>
<h1 id="lec2">lec2</h1>
<h2 id="design-of-pipeline">Design of pipeline</h2>
<p>Overlapping execution</p>
<p>The difference between stages (IF - ID - EX) may cause time consumption or resource competition.</p>
<ul>
<li>ä¸€æ¬¡é‡å ï¼ˆpartial overlapï¼‰ï¼šåœ¨è§£ç ç¬¬ k æ¡æŒ‡ä»¤æ—¶å¼€å§‹æ‰§è¡Œç¬¬ k+1 æ¡æŒ‡ä»¤ã€‚å¯ä»¥ç¼©çŸ­æ€»ä½“è€—æ—¶ï¼Œä½†ä¼šä½¿æ§åˆ¶é€»è¾‘æ›´å¤æ‚ã€‚</li>
<li>äºŒæ¬¡é‡å ï¼ˆfurther overlapï¼‰ï¼šåœ¨æ‰§è¡Œç¬¬ k æ¡æŒ‡ä»¤æ—¶å¹¶è¡Œå¤„ç†ç¬¬ k+1 æ¡æŒ‡ä»¤ã€‚</li>
</ul>
<p>ä¸ºäº†è§£å†³å†…å­˜è®¿é—®å†²çªï¼ˆä¾‹å¦‚ instruction cache ä¸ data cache å…±äº«ï¼Œæˆ–æŒ‡ä»¤å­˜å‚¨å™¨ imem ä¸æ•°æ®å­˜å‚¨å™¨ dmem å†²çªï¼‰ï¼Œå¯ä»¥åœ¨ä¸»å­˜æ§åˆ¶å™¨ä¸æŒ‡ä»¤è¯‘ç å•å…ƒä¹‹é—´å¢åŠ æŒ‡ä»¤ç¼“å†²åŒºï¼ˆinstruction bufferï¼‰ã€‚
ç¼“å†²åŒºå¯ä»¥ä¸´æ—¶å­˜æ”¾å¤šæ¡å–å‡ºçš„æŒ‡ä»¤ï¼Œé™ä½å–æŒ‡ä¸è®¿å­˜ä¹‹é—´çš„å†²çªï¼Œä»è€Œå‡å°‘æµæ°´çº¿åœé¡¿ã€‚</p>
<p><img alt="Single Overlapping Execution" src="../imgs/single_overlapping_execution.png" /></p>
<p>bufferåœ¨è¿›å…¥ä¸æ’ç©ºçš„æ—¶å€™ä¸€å®šä¼šå­˜åœ¨æ—¶é—´çš„æµªè´¹ã€‚</p>
<p>SCPUé‡Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æŒ‡ä»¤éƒ½ä¼šç”¨åˆ°äº”ä¸ªé˜¶æ®µï¼Œäºæ­¤å­˜åœ¨éƒ¨åˆ†æµªè´¹ã€‚</p>
<h2 id="classes-of-pipelining">Classes of pipelining</h2>
<ul>
<li>
<p>single function</p>
</li>
<li>
<p>multi function</p>
</li>
<li>static:åˆ‡æ¢åŠŸèƒ½çš„æ—¶å€™å¿…é¡»è¦æ’ç©º</li>
<li>
<p>dynamic:åŒæ—¶å¯ä»¥æ‰§è¡Œä¸¤ç§åŠŸèƒ½ï¼ˆçœ‹çœ‹éƒ½éš¾ï¼‰</p>
</li>
<li>
<p>çº¿æ€§æµæ°´çº¿ï¼šå„é˜¶æ®µä¸²è”è¿æ¥ä¸”æ— åé¦ˆå›è·¯ã€‚æ•°æ®æµç»æ¯ä¸ªé˜¶æ®µæ—¶ï¼Œæ¯ä¸ªé˜¶æ®µæœ€å¤šåªèƒ½è¿›è¡Œä¸€æ¬¡ä¼ è¾“ã€‚</p>
</li>
<li>
<p>éçº¿æ€§æµæ°´çº¿ï¼šé™¤ä¸²è”è¿æ¥å¤–ï¼Œè¿˜è®¾æœ‰åé¦ˆå›è·¯ã€‚é¿å…äº§ç”Ÿå†²çª</p>
</li>
</ul>
<p><img alt="nonlinear pipelining" src="../imgs/lec2-nonlinearpipelining.png" /></p>
<h2 id="an-inplementation-of-pipelining-cpurisc-v">An Inplementation of pipelining cpu(risc-v)</h2>
<p><img alt="æµæ°´çº¿ä¸¾ä¾‹" src="../imgs/lec2-pipeline%20cpu.png" /></p>
<h3 id="understand-how-pipelined-datapath-work">understand how pipelined datapath work</h3>
<h4 id="loadstore-instruction">load/store instruction</h4>
<ul>
<li>
<p>storeæŒ‡ä»¤ä¹ŸæŠŠæŒ‡ä»¤å­˜å…¥å¯„å­˜å™¨ä¸­</p>
</li>
<li>
<p>éšç€æµæ°´çº¿çš„è¿›è¡Œï¼ŒloadæŒ‡ä»¤çš„è¿”å›åœ°å€å¯èƒ½å·²ç»è¢«åç»­çš„æŒ‡ä»¤æ”¹å†™ï¼Œæˆ‘ä»¬éœ€è¦æŠŠåŸå…ˆpcä¹Ÿè¦é€šè¿‡ä¸­é—´å¯„å­˜å™¨è¿›è¡Œä¼ é€’ï¼Œè¿™æ ·å¯ä»¥ä¿è¯å†™å›åœ°å€çš„æ­£ç¡®æ€§ã€‚</p>
</li>
</ul>
<p>é‚£ä¹ˆä¼˜åŒ–å¯ä»¥å¾—åˆ°cpuã€‚</p>
<p><img alt="ä¼˜åŒ–çš„cpu" src="../imgs/lec2-pipeliningcorrected.png" /></p>
<h4 id="control-signals">control signals</h4>
<table>
<thead>
<tr>
<th>ä¿¡å·åç§°</th>
<th>æœªæ–­è¨€ï¼ˆ0ï¼‰æ•ˆæœ</th>
<th>æ–­è¨€ï¼ˆ1ï¼‰æ•ˆæœ</th>
</tr>
</thead>
<tbody>
<tr>
<td>RegWrite</td>
<td>ä¸æ‰§è¡Œä»»ä½•å¯„å­˜å™¨å†™æ“ä½œ</td>
<td>å°†â€œå†™æ•°æ®â€å†™å…¥æŒ‡ä»¤æŒ‡å®šçš„ç›®æ ‡å¯„å­˜å™¨ï¼ˆç”± IR çš„ rd å­—æ®µç¡®å®šï¼‰</td>
</tr>
<tr>
<td>ALUSrc</td>
<td>ALU çš„ç¬¬äºŒä¸ªæ“ä½œæ•°æ¥è‡ªå¯„å­˜å™¨è¯»æ•°æ® 2</td>
<td>ALU çš„ç¬¬äºŒä¸ªæ“ä½œæ•°æ¥è‡ªæŒ‡ä»¤çš„ 12 ä½ç¬¦å·æ‰©å±•ç«‹å³æ•°</td>
</tr>
<tr>
<td>PCSrc</td>
<td>PC æ›´æ–°ä¸ºå½“å‰ PC + 4ï¼ˆé¡ºåºæ‰§è¡Œï¼‰</td>
<td>PC æ›´æ–°ä¸ºåˆ†æ”¯ç›®æ ‡åœ°å€ï¼ˆç”± EX é˜¶æ®µ ALU è®¡ç®—å¾—å‡ºï¼‰</td>
</tr>
<tr>
<td>MemRead</td>
<td>ä¸è¯»å–æ•°æ®å†…å­˜å†…å®¹</td>
<td>æŒ‰è¾“å…¥åœ°å€è¯»å–æ•°æ®å†…å­˜ï¼Œå°†ç»“æœè¾“å‡ºåˆ°â€œRead dataâ€ç«¯</td>
</tr>
<tr>
<td>MemWrite</td>
<td>ä¸ä¿®æ”¹æ•°æ®å†…å­˜å†…å®¹</td>
<td>æŒ‰è¾“å…¥åœ°å€å°†â€œå†™æ•°æ®â€ï¼ˆæ¥è‡ª Read data 2ï¼‰å†™å…¥æ•°æ®å†…å­˜</td>
</tr>
<tr>
<td>MemtoReg</td>
<td>å¯„å­˜å™¨å†™å›æ•°æ®æ¥è‡ª ALU è¾“å‡ºï¼ˆALUOutputï¼‰</td>
<td>å¯„å­˜å™¨å†™å›æ•°æ®æ¥è‡ªæ•°æ®å†…å­˜çš„è¯»ç»“æœï¼ˆRead dataï¼‰</td>
</tr>
</tbody>
</table>
<p><img alt="finalcpu" src="../imgs/lec2-finalcpu.png" /></p>
<h2 id="performance-evaluation-of-pipelining">Performance evaluation of pipelining</h2>
<p><img alt="time" src="../imgs/lec2-pipelinetime.png" /></p>
<h3 id="throughputp"><strong>Throughpu(TP)</strong></h3>
<h4 id="tp">ä¸€ã€TPçš„æ ¸å¿ƒå®šä¹‰ä¸æœ¬è´¨</h4>
<p>ååé‡ï¼ˆThroughputï¼Œç®€ç§°TPï¼‰æ˜¯è¡¡é‡æµæ°´çº¿æ€§èƒ½çš„æ ¸å¿ƒæŒ‡æ ‡ï¼ŒæŒ‡<strong>å•ä½æ—¶é—´å†…æµæ°´çº¿èƒ½å¤Ÿå®Œæˆçš„æŒ‡ä»¤æˆ–è®¡ç®—ä»»åŠ¡æ•°é‡</strong></p>
<p>$$TP = \frac{n}{T}$$</p>
<p>å…¶ä¸­ï¼Œ(n) ä»£è¡¨å®Œæˆçš„æŒ‡ä»¤ï¼ˆæˆ–ä»»åŠ¡ï¼‰æ€»æ•°ï¼Œ(T) ä»£è¡¨å®Œæˆ (n) ä¸ªæŒ‡ä»¤ï¼ˆæˆ–ä»»åŠ¡ï¼‰çš„æ€»æ‰§è¡Œæ—¶é—´ã€‚</p>
<p>å®Œæˆ (n) ä¸ªæŒ‡ä»¤çš„æ€»æ—¶é—´ç”±ä¸¤éƒ¨åˆ†æ„æˆ,ç¬¬ä¸€å¥è¯­å¥çš„åŠ è½½ï¼ˆmï¼‰ï¼Œå’Œåç»­ï¼ˆn-1ï¼‰ä¸ªè¯­å¥çš„è¿è¡Œã€‚</p>
<p>å› æ­¤ï¼Œæ€»æ‰§è¡Œæ—¶é—´å…¬å¼ä¸ºï¼š  </p>
<p>$$T = (m + n - 1) \times \Delta t_0$$</p>
<ul>
<li>ç†æƒ³æµæ°´çº¿çš„TPå…¬å¼ï¼šå°†æ€»æ‰§è¡Œæ—¶é—´ä»£å…¥TPæ ¸å¿ƒå…¬å¼ï¼Œå¯å¾—<br />
  $$TP = \frac{n}{(m + n - 1) \times \Delta t_0}$$  </li>
<li>æœ€å¤§ååé‡ï¼ˆ(TP_{max})ï¼‰ï¼šå½“æŒ‡ä»¤æ€»æ•° (n \gg m)ï¼ˆæŒ‡ä»¤æ•°è¿œå¤§äºæµæ°´çº¿é˜¶æ®µæ•°ï¼‰æ—¶ï¼Œ(m) å’Œ (-1) å¯å¿½ç•¥ï¼Œæ­¤æ—¶ (TP) æ— é™æ¥è¿‘ (TP_{max})ï¼Œä¸” (TP_{max}) ç”±å•é˜¶æ®µæ—¶é—´å†³å®šï¼š<br />
  $$TP_{max} = \frac{1}{\Delta t_0}$$  </li>
<li>å®é™…TPä¸ (TP_{max}) çš„å…³è”ï¼šé€šè¿‡å…¬å¼å˜å½¢å¯æ˜ç¡®ä¸¤è€…çš„æ¯”ä¾‹å…³ç³»ï¼Œå³<br />
  $$TP = \frac{n}{n + m - 1} \times TP_{max}$$</li>
</ul>
<p>ä¾‹å¦‚ï¼Œåœ¨å‰æ–‡ç¤ºä¾‹ä¸­å¯ç»™å‡ºä¸€äº›å¸¸è§é‡åŒ–å€¼ï¼ˆä»…ç¤ºä¾‹ï¼‰:</p>
<h4 id="solve-pipeline-bottleneck">solve pipeline bottleneck</h4>
<ul>
<li>subdivision</li>
<li>repetition 
<img alt="repetiton" src="../imgs/lec2-reprtition.png" /></li>
</ul>
<h3 id="speedupsp-"><strong>Speedup(sp)</strong> --åŠ é€Ÿæ¯”</h3>
<h3 id="speedup-sp">Speedup (Sp) ä¸æ•ˆç‡ (Î·)</h3>
<p>é€Ÿåº¦åŠ é€Ÿæ¯”ï¼š
$$
Sp = \frac{n \times m \times \Delta t_0}{(m + n - 1)\times \Delta t_0}
= \frac{n\,m}{m + n - 1}
$$</p>
<p>æµæ°´çº¿æ•ˆç‡ï¼ˆæ¯é˜¶æ®µå¹³å‡åˆ©ç”¨ç‡ï¼‰ï¼š
$$
\eta = \frac{Sp}{m}
= \frac{\dfrac{n\,m}{m + n - 1}}{m}
= \frac{n}{m + n - 1}
$$</p>
<p>å½“ n \gg m æ—¶ï¼ŒSp \to mï¼Œ\eta \to 1ï¼ˆæ¥è¿‘ç†æƒ³æƒ…å†µï¼‰ã€‚</p>
<p><img alt="evaluationexp" src="../imgs/lec2-evaluationexp.png" /></p>
<p>$$T_p = \frac{7}{15}\,\Delta t$$</p>
<p>$$S_p = \frac{4\cdot 3\,\Delta t + 3\cdot 4\,\Delta t}{15\,\Delta t} = 1.6$$</p>
<p>$$\eta = \frac{3\times 4\,\Delta t + 4\times 3\,\Delta t}{5\times 15\,\Delta t} = 32\%$$</p>
<p><img alt="evexp2" src="../imgs/lec2-evaluationexp2.png" /></p>
<h1 id="lec3">lec3</h1>
<p>Increasing instruction throughput (å¹¶è¡Œæ€§)</p>
<h2 id="hazards-of-pipelining">Hazards of pipelining</h2>
<p><img alt="introduction" src="../imgs/lec3-introductionhazard.png" /></p>
<h3 id="stuctural-hazard">stuctural hazard</h3>
<p>A required resource is busy.</p>
<p><img alt="structualhazard" src="../imgs/lec3-structuralhazard.png" /></p>
<ul>
<li>
<p>Solution 1: Instructions take it in turns to use resource, some instructions have to stall</p>
</li>
<li>
<p>Solution 2: Add more hardware to machine</p>
</li>
</ul>
<h3 id="data-hazards">data hazards</h3>
<p><img alt="datahazard" src="../imgs/lec3-datahazard.png" /></p>
<h4 id="forwarding">forwarding</h4>
<p>Adding extra hardware to retrieve the missing item early from the internal resources</p>
<p><img alt="forwarding" src="../imgs/lec3-forwarding2.png" /></p>
<h5 id="forwardingpath">forwardingpath</h5>
<p><img alt="forwardingpath" src="../imgs/lec3-forwardingpath.png" /></p>
<h5 id="forwarding-conditions">forwarding conditions</h5>
<p>EX hazardå’ŒMEM hazard</p>
<table>
<thead>
<tr>
<th>ä¿¡å·</th>
<th>çŠ¶æ€</th>
<th>æ“ä½œæ•°æ¥æº</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>ForwardA</td>
<td>00</td>
<td>ID/EXå¯„å­˜å™¨</td>
<td>æ¥è‡ªå¯„å­˜å™¨å †çš„åŸå§‹å€¼</td>
</tr>
<tr>
<td>ForwardA</td>
<td>10</td>
<td>EX/MEMå¯„å­˜å™¨</td>
<td>å‰ä¸€æ¡æŒ‡ä»¤çš„ALUç»“æœï¼ˆæœªå†™å›å¯„å­˜å™¨å †ï¼‰</td>
</tr>
<tr>
<td>ForwardA</td>
<td>01</td>
<td>MEM/WBå¯„å­˜å™¨</td>
<td>æ›´æ—©æŒ‡ä»¤çš„ç»“æœï¼ˆå†…å­˜æ•°æ®æˆ–æ—©æœŸALUç»“æœï¼‰</td>
</tr>
<tr>
<td>ForwardB</td>
<td>00</td>
<td>ID/EXå¯„å­˜å™¨</td>
<td>æ¥è‡ªå¯„å­˜å™¨å †çš„åŸå§‹å€¼</td>
</tr>
<tr>
<td>ForwardB</td>
<td>10</td>
<td>EX/MEMå¯„å­˜å™¨</td>
<td>å‰ä¸€æ¡æŒ‡ä»¤çš„ALUç»“æœï¼ˆæœªå†™å›å¯„å­˜å™¨å †ï¼‰</td>
</tr>
<tr>
<td>ForwardB</td>
<td>01</td>
<td>MEM/WBå¯„å­˜å™¨</td>
<td>æ›´æ—©æŒ‡ä»¤çš„ç»“æœï¼ˆå†…å­˜æ•°æ®æˆ–æ—©æœŸALUç»“æœï¼‰</td>
</tr>
</tbody>
</table>
<h4 id="double-data-hazard">Double Data hazard</h4>
<div class="highlight"><pre><span></span><code><span class="nf">add</span><span class="w"> </span><span class="no">x1</span><span class="p">,</span><span class="no">x1</span><span class="p">,</span><span class="no">x2</span>
<span class="nf">add</span><span class="w"> </span><span class="no">x1</span><span class="p">,</span><span class="no">x1</span><span class="p">,</span><span class="no">x3</span>
<span class="nf">add</span><span class="w"> </span><span class="no">x1</span><span class="p">,</span><span class="no">x1</span><span class="p">,</span><span class="no">x4</span>
</code></pre></div>
<p>Use the most recent data.(åœ¨å‰ç½®æ¡ä»¶å½“ä¸­åŠ å…¥åˆ¤æ–­ä¸æ˜¯EX hazard)</p>
<h4 id="load-use-hazard">Load-Use Hazard</h4>
<div class="highlight"><pre><span></span><code>lw x1, 0(x2)   # MEMé˜¶æ®µæœ«å°¾æ‰è·å–x1çš„å€¼
add x3, x1, x4 # EXé˜¶æ®µéœ€x1ï¼Œå‰æ¨æ— æ³•åŠæ—¶æä¾›
</code></pre></div>
<p>ç”±æ­¤æˆ‘ä»¬éœ€è¦å¼•å…¥stallæœºåˆ¶, å†åŠ ä¸Šforwardingæ¥å®ç°ã€‚</p>
<h3 id="pipelining-with-stall">Pipelining with stall</h3>
<ul>
<li>Force control values in ID/EX register 0</li>
<li>Prevent update of PC and IF/ID register
(å¯ä»¥ä½¿ç”¨è½¯ä»¶é‡æ’åºæ¥é¿å…å†²çªå¯¼è‡´æ•ˆç‡æµªè´¹)
--NOP</li>
</ul>
<p><img alt="stall" src="../imgs/lec3-stalldatapath.png" /></p>
<h3 id="control-hazards">control hazards</h3>
<p>flow of excution depends on previous instruction.</p>
<p>Problem:THe conditional branch instruction(B/J)</p>
<p>å­˜åœ¨forwardingä¹Ÿè§£å†³ä¸äº†çš„é—®é¢˜ï¼ˆbæŒ‡ä»¤ç´§é‚»ç›¸å…³è¯­å¥çš„æƒ…å†µï¼‰æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼•å…¥stallä½¿ä¹‹åˆ°è¾¾å¯ä»¥å®ç°çš„æ—¶å€™ã€‚</p>
<h4 id="branch-hazards">Branch hazards</h4>
<p><img alt="branchhazard" src="../imgs/lec3-branchhazard.png" /></p>
<p>beqçš„ç»“æœæˆ‘ä»¬éœ€è¦ç­‰åˆ°è¿è¡Œåˆ°ç¬¬ä¸‰é˜¶æ®µæ‰èƒ½å¾—åˆ°ï¼Œäºæ˜¯æˆ‘ä»¬æµªè´¹äº†3 clock cyclesã€‚</p>
<h4 id="how-to-reduce-stall">How to reduce stall</h4>
<ul>
<li>in risc-v pipelining</li>
<li>compare registers and compute target <code>early</code> in the pipelining</li>
<li>
<p>add hardware to do in ID stage</p>
</li>
<li>
<p>key processes in branch instructions</p>
</li>
<li>compute the branch target address</li>
<li>
<p>judge if the branch success</p>
</li>
<li>
<p>determine outcome to ID stage</p>
</li>
<li>target address adder</li>
<li>register comparator</li>
</ul>
<p><img alt="solution1" src="../imgs/lec3-solutionstall.png" /></p>
<p>â€˜èµŒåšâ€™</p>
<p><img alt="solution2" src="../imgs/lec3-solutionprediction.png" /></p>
<p>æ›´åŠ é«˜çº§çš„ç‰ˆæœ¬--é¢„æµ‹ä¸€éƒ¨åˆ†æ¡ä»¶åˆ†æ”¯ä¸ä¼šå‘ç”Ÿ</p>
<p>expï¼šé’ˆå¯¹å¾ªç¯åº•éƒ¨çš„æ¡ä»¶åˆ†æ”¯ï¼Œå› ä¸ºè¿™ç±»åˆ†æ”¯ â€œå¾ˆå¯èƒ½è·³è½¬åˆ°å¾ªç¯é¡¶éƒ¨ï¼ˆthey are likely to be taken to the top of the loopsï¼‰â€ï¼Œæ‰€ä»¥å¯¹äºæ›´æ—©åœ°å€çš„è¿™ç±»åˆ†æ”¯ï¼Œä¼š â€œæ€»æ˜¯é¢„æµ‹è·³è½¬ï¼ˆalways predict takenï¼‰â€ï¼Œä»¥æ­¤ä¼˜åŒ–æµæ°´çº¿æ‰§è¡Œï¼Œå‡å°‘å› æ§åˆ¶å†’é™©å¯¼è‡´çš„åœé¡¿ã€‚</p>
<p><img alt="solution3" src="../imgs/lec3-Delayed%20Decision.png" /></p>
<h4 id="more-about-reducing-branch-delay">More About -- Reducing Branch Delay</h4>
<h5 id="predict-branch-takenuntaken">Predict branch taken/untaken</h5>
<p><img alt="predictriscv" src="../imgs/lec3-predictriscv.png" /></p>
<h5 id="delay-branchriscvhh">Delay Branchï¼ˆriscvä¸ç”¨äº†hhï¼‰</h5>
<p>åˆ†æ”¯å»¶è¿Ÿæ§½(delay slot)é€šè¿‡å¼ºåˆ¶æ‰§è¡Œåˆ†æ”¯åçš„ä¸€æ¡æŒ‡ä»¤ï¼Œè®©æµæ°´çº¿åœ¨åˆ†æ”¯åˆ¤æ–­æœŸé—´ä¿æŒå¿™ç¢Œï¼Œå‡å°‘å› æ§åˆ¶å†’é™©é€ æˆçš„æ€§èƒ½æŸå¤±ã€‚</p>
<h4 id="dynamic-branch-prediction">Dynamic Branch Prediction</h4>
<p>æ ¹æ®å½“å‰æŒ‡ä»¤çš„è·³è½¬å†å²åšåˆ¤åˆ«(çŒœæµ‹ä¹‹ç±»çš„)
 - Branch prediction buffer
 - Indexed by recent branch instruction address
 - stores outcome
 - excute branch</p>
<h4 id="branch-history-tablebhtfsm">Branch History Table(BHT)(FSM)</h4>
<h5 id="1-bit-predictorshortcoming">1-bit Predictor:shortcoming</h5>
<p>æ¯é”™è¯¯é¢„æµ‹ä¸€æ¬¡å°±ä¼šä¿®æ”¹é¢„æœŸçŠ¶æ€ï¼ˆå¤–å¾ªç¯å’Œå†…å¾ªç¯ä¼šé€ æˆä¸¤æ¬¡çš„è·³è½¬ä¿®æ”¹ï¼‰</p>
<h5 id="2-bit">2-bit</h5>
<p><img alt="2bitBHT" src="../imgs/lec3-2bitBHT.png" /></p>
<p>å·§å¦™è§£å†³äº†å†…å¾ªç¯1000æ¬¡å¤–å¾ªç¯10000æ¬¡çš„çŸ›ç›¾ï¼ˆè¿ç»­ä¸¤æ¬¡è·³è½¬ä¸æ­£å¸¸æ‰ä¿®æ”¹çŠ¶æ€ï¼‰</p>
<ul>
<li>Branch-Target buffer</li>
<li>é€Ÿåº¦æ›´å¿«</li>
<li>æä¾›æ›´å¤šçš„æŒ‡ä»¤</li>
<li>Integrated Instruction Fetch Unitsï¼ˆå¯èƒ½éœ€è¦å¤šä¸ªå‘¨æœŸæ¥å–åœ°å€ï¼‰</li>
</ul>
<h1 id="lec5">lec5</h1>
<h2 id="scheduling-of-nonlinear-pipelining">Scheduling of NONlinear pipelining</h2>
<p>å­˜åœ¨å›ç¯ å­˜åœ¨å†²çª</p>
<p><img alt="nonlinear" src="../imgs/lec2-nonlinearpipelining.png" /></p>
<p>Reservationn table </p>
<p><img alt="conflictvector" src="../imgs/lec5-conflictvector.png" /></p>
<p>ä½œå›¾å¾—åˆ°ï¼Œéœ€è¦è¡¥å……çš„äº‹ï¼ˆ1ï¼Œ5ï¼Œ6ï¼Œ8ï¼‰æ˜¯æ ¹æ®åŒä¸€ä¸ªéƒ¨ä»¶é—´éš”å¤šå°‘å‘¨æœŸå¯èƒ½å­˜åœ¨å†²çªå†³å®šçš„ï¼Œè€Œå†²çªå‘é‡æ˜¯æŠŠå¯¹åº”ä½ç½®æ”¾ç½®ä¸º1å¾—åˆ°çš„ ï¼ˆ10110001ï¼‰</p>
<p><img alt="conflict" src="../imgs/lec5-conflictexp.png" /></p>
<p>å¤šç§æƒ…å†µï¼Œä»¥åŠé¢„æœŸçš„æ—¶é’Ÿå‘¨æœŸçš„é•¿åº¦ï¼Œæ‹‰é•¿äº†æ—¶é—´çš„å‘å°„é—´éš”ï¼š</p>
<p><img alt="fsm" src="../imgs/lec5-FSMtransiton.png" /></p>
<h2 id="multiple-issue">Multiple Issue</h2>
<h3 id="instruction-level-parallelismilp">Instruction-Level Parallelismï¼ˆILPï¼‰å¹¶è¡Œæ€§</h3>
<ul>
<li>Deeper pipeline</li>
<li>Multiple issue(4-way multiple-issue)</li>
<li>dependencies reduce this in practice</li>
</ul>
<h3 id="speculation">Speculation</h3>
<ul>
<li>Guess what to do with an instruction.</li>
<li>
<p>Common to static and dynamic multiple issue.(on branch outcome or load)</p>
</li>
<li>
<p>Compiler Speculation:reorder instructions(move load before branch)</p>
</li>
<li>
<p>Hardware Speculation:look ahead for instructions to excute</p>
</li>
</ul>
<h3 id="superscalar">Superscalar</h3>
<p>è¶…æ ‡é‡æµæ°´çº¿(1-8)ï¼šå®åˆ™å°±æ˜¯ä¸€æ¬¡æ€§å‘é€å¾ˆå¤šæ¡æŒ‡ä»¤ï¼Œåœ¨ä¸å†²çªçš„æ—¶å€™åŒæ—¶è¿›è¡Œ--å¼•å…¥äº†æ›´å¤šçš„ç¡¬ä»¶æ¥å®ç°å¤šæ¡æµæ°´çº¿çš„å¹¶è¡Œã€‚æŒ‰é¡ºåºçš„å‘å°„ï¼ŒåŒæ—¶å†²çªçš„åˆ é™¤åœ¨æµå‡ºçš„æ—¶å€™è¢«å¤„ç†å¥½ã€‚</p>
<p>Dual-Issue Risc-v</p>
<p>æ€ä¹ˆåšï¼Ÿ
1. æŒ‰é¡ºåºçš„æ£€æµ‹å‘å°„çš„åŒ…é‡Œé¢æ˜¯å¦å­˜åœ¨å†²çª
2. æ£€æµ‹åŒ…å’ŒåŒ…ä¹‹é—´çš„å†²çªï¼ˆdata hazardï¼‰</p>
<p>å‘å°„çš„æ—¶å€™ï¼š1æ¡æ•´å‹ + 1æ¡æµ®ç‚¹å‹ï¼ˆè¦æ±‚å¤šå¤ç”¨éƒ¨ä»¶ï¼‰</p>
<p>ALU/Branch æ§½
Load/Store æ§½</p>
<p>Hazardsçš„å¤„ç†
EX data hazard
 - forwarding avoided
<div class="highlight"><pre><span></span><code>LOOP:ld x31,0(x20)
    add x31,x31,x21
    sd x31,0(x20)
    addi x20,x20,-8
    blt x22,x20,loop
</code></pre></div></p>
<table>
<thead>
<tr>
<th>cycle</th>
<th>ALU/Branch æ§½</th>
<th>Load/Store æ§½</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>nop</td>
<td>ld x31,0(x20)</td>
</tr>
<tr>
<td>2</td>
<td>add x31,x31,x21</td>
<td>nop</td>
</tr>
<tr>
<td>3</td>
<td>add x20,x20,-8</td>
<td>sd x31,0(x20)</td>
</tr>
<tr>
<td>4</td>
<td>blt x22,x20,loop</td>
<td></td>
</tr>
</tbody>
</table>
<p>IPC = 5/4 = 1.25</p>
<h3 id="vlimvery-long-instruction-word">VLIM(Very Long Instruction Word)</h3>
<p>è¶…é•¿æŒ‡ä»¤å­—ï¼šæŠŠå¤šæ¡æŒ‡ä»¤æ†ç»‘åœ¨äº†ä¸€ä¸ªæŒ‡ä»¤å½“ä¸­ï¼Œæ¯nåˆ†ä¹‹ä¸€å‘é€ä¸€æ¡ï¼Œå…±næ¡</p>
<p><img alt="superpipeline" src="../imgs/lec5-superpipeline.png" /></p>
<h1 id="lec4-software-hardware-interface">lec4 Software-Hardware Interface</h1>
<h2 id="exceptions-and-interrupts">Exceptions and interrupts</h2>
<p>Exceptions:unexpected change in flow
interrupts:from an external I/O controller</p>
<h3 id="handling-exceptions">handling exceptions</h3>
<ul>
<li>save pc of offending instruction(SEPC)</li>
<li>save indication of the problem(SCAUSE)</li>
</ul>
<p>what to do?
read cause and tansfer to relevant handler
determine action required
if restartable
 - take corrective action
 - use SEPC to return to program
otherwive
 - terminate program
 - report error using SEPC,SCAUSE</p>
<p>æµæ°´çº¿ä¸­å¯èƒ½å¼•å…¥ä¹±åºå®Œæˆ</p>
<h2 id="software-hardware-interface">Software-Hardware Interface</h2>
<p>å¤ä¹ äº†ç³»ç»Ÿä¸€ï¼Ÿè®²äº†ä¸‹æ±‡ç¼–è¯­è¨€å’Œcpuï¼Œload programï¼Œexcute program</p>
<h2 id="brief-introduction-of-os">Brief introduction of OS</h2>
<p>resource allocator</p>
<h1 id="oslinux">OSï¼ˆåŸºäºlinuxï¼‰.</h1>
<h2 id="lec5_1">lec5</h2>
<p>From a hello-world program
- Compiler basics - Behind gcc main.c
- ELF binary basics - Whatâ€™s a.out
- Running a binary - Behind ./a.out</p>
<h3 id="compiler-basics">Compiler basics</h3>
<p><img alt="compiler" src="../imgs/lec5-compilerbasics.png" /></p>
<ul>
<li>é¢„å¤„ç†ï¼ˆcppï¼‰â†’ å±•å¼€å¤´æ–‡ä»¶</li>
<li>ç¼–è¯‘ï¼ˆgcc -Sï¼‰â†’ ç”Ÿæˆæ±‡ç¼– .s</li>
<li>æ±‡ç¼–ï¼ˆasï¼‰â†’ ç”Ÿæˆç›®æ ‡æ–‡ä»¶ .oï¼ˆELF æ ¼å¼ï¼‰</li>
<li>
<p>é“¾æ¥ï¼ˆld / gccï¼‰â†’ ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ a.out</p>
</li>
<li>
<p>crt
C runtime:Startup routines before main function ,Simplify code can be</p>
</li>
</ul>
<p><img alt="elf" src="../imgs/lec5-elf.png" /></p>
<p>åŒ…å«å¤šä¸ªæ®µï¼ˆsectionsï¼‰ï¼š
- .textï¼šä»£ç 
- .rodataï¼šåªè¯»æ•°æ®ï¼ˆå¦‚å­—ç¬¦ä¸²å¸¸é‡ï¼‰
- .dataï¼šå·²åˆå§‹åŒ–å…¨å±€å˜é‡
- .bssï¼šæœªåˆå§‹åŒ–å…¨å±€/é™æ€å˜é‡</p>
<p><img alt="Cpro" src="../imgs/lec5-Cpro.png" /></p>
<p>readelf -h a.out â†’ æŸ¥çœ‹ ELF å¤´
objdump -d a.out â†’ åæ±‡ç¼–ä»£ç </p>
<p>è¿è¡Œç¨‹åºï¼ˆ./a.outï¼‰å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
Shell è°ƒç”¨ execve ç³»ç»Ÿè°ƒç”¨
Linux å†…æ ¸ï¼š
åŠ è½½ ELF æ–‡ä»¶ï¼ˆload_elf_binaryï¼‰
è®¾ç½®æ ˆã€å †ã€å†…å­˜æ˜ å°„
è·³è½¬åˆ°å…¥å£ç‚¹ï¼ˆé€šå¸¸æ˜¯ _startï¼Œæ¥è‡ª crt0.oï¼‰
æœ€ç»ˆè°ƒç”¨ __libc_start_main â†’ æ‰§è¡Œ main()</p>
<h3 id="how-does-an-os-start">How does an OS start</h3>
<p>the bootstrap program</p>
<p>Part of the system firmware, which in turn loads a bootloader responsible for loading the OS.</p>
<h4 id="1-booting">1. å¯åŠ¨è¿‡ç¨‹ï¼ˆBootingï¼‰</h4>
<ul>
<li><strong>ç¬¬ä¸€æ­¥ï¼šå›ºä»¶ï¼ˆFirmwareï¼‰</strong></li>
<li>è®¡ç®—æœºåŠ ç”µåï¼Œé¦–å…ˆè¿è¡Œå­˜å‚¨åœ¨ <strong>ROM/Flash</strong> ä¸­çš„<strong>å¼•å¯¼ç¨‹åºï¼ˆBootstrap Programï¼‰</strong>ã€‚</li>
<li>åœ¨ RISC-V æ¶æ„å®éªŒä¸­ï¼Œä½¿ç”¨çš„æ˜¯ <strong>OpenSBI</strong>ã€‚</li>
<li><strong>ç¬¬äºŒæ­¥ï¼šåŠ è½½å†…æ ¸</strong></li>
<li>å¼•å¯¼ç¨‹åºåˆå§‹åŒ–ç¡¬ä»¶ï¼Œæ‰¾åˆ°ç¡¬ç›˜ä¸Šçš„ <strong>OS å†…æ ¸</strong>ï¼Œå°†å…¶åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶<strong>è·³è½¬æ‰§è¡Œ</strong>ã€‚</li>
</ul>
<h4 id="2-kernel-initialization">2. å†…æ ¸åˆå§‹åŒ–ï¼ˆKernel Initializationï¼‰</h4>
<ul>
<li>å†…æ ¸ç»§ç»­å®Œæˆåˆå§‹åŒ–ï¼š</li>
<li>è®¾ç½®å†…å­˜ç®¡ç†</li>
<li>åŠ è½½è®¾å¤‡é©±åŠ¨</li>
<li>å¯åŠ¨ç¬¬ä¸€ä¸ªç”¨æˆ·æ€è¿›ç¨‹ï¼ˆ<code>init</code> æˆ– <code>systemd</code>ï¼‰</li>
<li><strong>ä¹‹åï¼Œç³»ç»Ÿè¿›å…¥â€œäº‹ä»¶é©±åŠ¨â€æ¨¡å¼</strong>ï¼šä»€ä¹ˆéƒ½ä¸åšï¼Œç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿã€‚</li>
</ul>
<h4 id="3">3. æ ¸å¿ƒè¿è¡Œæœºåˆ¶ï¼šå¤šé“ç¨‹åºè®¾è®¡ &amp; åˆ†æ—¶</h4>
<ul>
<li><strong>å¤šé“ç¨‹åºè®¾è®¡ï¼ˆMulti-programmingï¼‰</strong>ï¼š</li>
<li>å¤šä¸ªç¨‹åºåŒæ—¶é©»ç•™åœ¨å†…å­˜ä¸­ã€‚</li>
<li>
<p>å½“ä¸€ä¸ªç¨‹åºç­‰å¾… I/O æ—¶ï¼ŒCPU åˆ‡æ¢å»æ‰§è¡Œå¦ä¸€ä¸ªç¨‹åº â†’ <strong>æé«˜ CPU åˆ©ç”¨ç‡</strong>ã€‚</p>
</li>
<li>
<p><strong>åˆ†æ—¶ç³»ç»Ÿï¼ˆTime-sharingï¼‰</strong>ï¼š</p>
</li>
<li>å¤šé“ç¨‹åºè®¾è®¡çš„å‡çº§ç‰ˆï¼Œé€šè¿‡<strong>å¿«é€Ÿä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ï¼Œç»™æ¯ä¸ªç”¨æˆ·â€œç‹¬å æœºå™¨â€çš„é”™è§‰ã€‚</li>
<li>è¿™å°±æ˜¯ç°ä»£â€œè¿›ç¨‹ï¼ˆProcessï¼‰â€æ¦‚å¿µçš„æ¥æºã€‚</li>
</ul>
<h4 id="4-vs-user-vs-kernel-mode">4. ç”¨æˆ·æ€ vs å†…æ ¸æ€ï¼ˆUser vs Kernel Modeï¼‰</h4>
<ul>
<li><strong>ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ç§æ¨¡å¼ï¼Ÿ</strong></li>
<li><strong>å®‰å…¨ä¸ä¿æŠ¤</strong>ï¼šé˜²æ­¢ç”¨æˆ·ç¨‹åºç›´æ¥æ“ä½œç¡¬ä»¶æˆ–ç ´åå…¶ä»–ç¨‹åºã€‚</li>
<li><strong>ç‰¹æƒæŒ‡ä»¤ï¼ˆProtected Instructionsï¼‰</strong>ï¼š</li>
<li>åªèƒ½åœ¨<strong>å†…æ ¸æ€</strong>æ‰§è¡Œï¼Œä¾‹å¦‚ï¼š<ul>
<li>ç›´æ¥è®¿é—® I/O è®¾å¤‡</li>
<li>ä¿®æ”¹å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰</li>
<li>å…³é—­ä¸­æ–­</li>
<li>è®¾ç½®ç³»ç»Ÿå®šæ—¶å™¨</li>
</ul>
</li>
<li><strong>æ¨¡å¼åˆ‡æ¢</strong>ï¼š</li>
<li><strong>ç”¨æˆ·æ€ â†’ å†…æ ¸æ€</strong>ï¼šé€šè¿‡<strong>äº‹ä»¶</strong>ï¼ˆä¸­æ–­ã€å¼‚å¸¸ã€ç³»ç»Ÿè°ƒç”¨ï¼‰è§¦å‘ã€‚</li>
<li><strong>å†…æ ¸æ€ â†’ ç”¨æˆ·æ€</strong>ï¼šå†…æ ¸å¤„ç†å®Œäº‹ä»¶åï¼Œè¿”å›ç”¨æˆ·ç¨‹åºã€‚</li>
</ul>
<h4 id="5-the-os-as-an-event-handler">5. äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼ˆThe OS as an Event Handlerï¼‰</h4>
<ul>
<li><strong>æ“ä½œç³»ç»Ÿæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå·¨å¤§çš„äº‹ä»¶å¤„ç†å™¨</strong>ã€‚</li>
<li>
<p><strong>ä¸¤ç±»äº‹ä»¶</strong>ï¼š
  | äº‹ä»¶ç±»å‹ | è§¦å‘æº | ä¾‹å­ |
  |---|---|---|
  | <strong>ä¸­æ–­ï¼ˆInterruptsï¼‰</strong> | ç¡¬ä»¶ | é”®ç›˜è¾“å…¥ã€ç½‘ç»œæ•°æ®åŒ…åˆ°è¾¾ã€å®šæ—¶å™¨åˆ°æœŸ |
  | <strong>å¼‚å¸¸/é™·é˜±ï¼ˆExceptions/Trapsï¼‰</strong> | è½¯ä»¶/CPU | ç³»ç»Ÿè°ƒç”¨ã€é™¤é›¶é”™è¯¯ã€ç¼ºé¡µå¼‚å¸¸ã€éæ³•æŒ‡ä»¤ |</p>
</li>
<li>
<p><strong>ç³»ç»Ÿè°ƒç”¨ï¼ˆSystem Callsï¼‰</strong>ï¼š</p>
</li>
<li>æ˜¯ä¸€ç§ç‰¹æ®Šçš„â€œtrapâ€ï¼Œæ˜¯<strong>ç”¨æˆ·ç¨‹åºè¯·æ±‚å†…æ ¸æœåŠ¡çš„å”¯ä¸€åˆæ³•é€”å¾„</strong>ã€‚</li>
<li>ä¾‹å¦‚ï¼š<code>write()</code>, <code>fork()</code>, <code>open()</code>ã€‚</li>
<li>åœ¨ x86-64 ä¸Šï¼Œé€šè¿‡ <code>syscall</code> æŒ‡ä»¤è§¦å‘ã€‚</li>
</ul>
<h4 id="6-timer">6. å®šæ—¶å™¨ï¼ˆTimerï¼‰ï¼šå†…æ ¸çš„â€œå¤ºæƒâ€å·¥å…·</h4>
<ul>
<li><strong>é—®é¢˜</strong>ï¼šå¦‚æœä¸€ä¸ªç”¨æˆ·ç¨‹åºæ°¸ä¸å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸å¦‚ä½•å¤ºå› CPU æ§åˆ¶æƒï¼Ÿ</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š<strong>å¯ç¼–ç¨‹å®šæ—¶å™¨</strong>ã€‚</li>
<li>å†…æ ¸åœ¨äº¤å‡º CPU å‰ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ä¸­æ–­ï¼ˆå¦‚æ¯ 10ms ä¸€æ¬¡ï¼‰ã€‚</li>
<li>æ—¶é—´ä¸€åˆ°ï¼Œç¡¬ä»¶å¼ºåˆ¶äº§ç”Ÿä¸­æ–­ï¼ŒCPU åˆ‡å›å†…æ ¸æ€ã€‚</li>
<li>è¿™æ˜¯å®ç°<strong>å…¬å¹³è°ƒåº¦</strong>å’Œ<strong>æŠ¢å å¼å¤šä»»åŠ¡</strong>çš„åŸºç¡€ã€‚</li>
</ul>
<hr />
<h3 id="resource-management">ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ“ä½œç³»ç»Ÿå¦‚ä½•ç®¡ç†èµ„æºï¼Ÿï¼ˆResource Managementï¼‰</h3>
<p>è¿™éƒ¨åˆ†åˆ—å‡ºäº† OS æä¾›çš„äº”å¤§æ ¸å¿ƒæœåŠ¡ï¼š</p>
<table>
<thead>
<tr>
<th>æœåŠ¡</th>
<th>è´Ÿè´£å†…å®¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1. è¿›ç¨‹ç®¡ç†ï¼ˆProcess Managementï¼‰</strong></td>
<td>åˆ›å»º/åˆ é™¤è¿›ç¨‹ã€è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ã€åŒæ­¥ã€æ­»é”å¤„ç†</td>
</tr>
<tr>
<td><strong>2. å†…å­˜ç®¡ç†ï¼ˆMemory Managementï¼‰</strong></td>
<td>è·Ÿè¸ªå†…å­˜ä½¿ç”¨ã€å†³å®šå“ªäº›è¿›ç¨‹/æ•°æ®åœ¨å†…å­˜ä¸­ã€åˆ†é…/å›æ”¶å†…å­˜</td>
</tr>
<tr>
<td><strong>3. å­˜å‚¨ç®¡ç†ï¼ˆStorage Managementï¼‰</strong></td>
<td>æ–‡ä»¶ç³»ç»Ÿã€ç›®å½•ç®¡ç†ã€ç£ç›˜ç©ºé—´åˆ†é…ã€å¤‡ä»½</td>
</tr>
<tr>
<td><strong>4. I/O ç®¡ç†ï¼ˆI/O Managementï¼‰</strong></td>
<td>éšè—ç¡¬ä»¶ç»†èŠ‚ã€æä¾›ç»Ÿä¸€è®¾å¤‡é©±åŠ¨æ¥å£ã€ç¼“å†²/å‡è„±æœºï¼ˆSpoolingï¼‰</td>
</tr>
<tr>
<td><strong>5. ä¿æŠ¤ä¸å®‰å…¨ï¼ˆProtection and Securityï¼‰</strong></td>
<td>è®¿é—®æ§åˆ¶ï¼ˆç”¨æˆ·ID/ç»„IDï¼‰ã€å†…å­˜/è®¾å¤‡ä¿æŠ¤ã€é˜²å¾¡æ”»å‡»ï¼ˆç—…æ¯’ã€DoSï¼‰</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="_1">ğŸ’¡ å››ã€å…³é”®è®¨è®ºé¢˜ï¼ˆæ€è€ƒé¢˜ï¼‰</h2>
<p>PDF æœ€åæå‡ºäº†ä¸€ä¸ªç»å…¸çš„é¢è¯•/è€ƒè¯•é¢˜ï¼š</p>
<blockquote>
<p><strong>ä»¥ä¸‹å“ªäº›æŒ‡ä»¤åº”è¯¥æ˜¯ç‰¹æƒæŒ‡ä»¤ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong>
- è®¾ç½®ç³»ç»Ÿå®šæ—¶å™¨ â†’ <strong>æ˜¯</strong>ï¼ˆå½±å“è°ƒåº¦å…¬å¹³æ€§ï¼‰
- è¯»å–æ—¶é’Ÿ â†’ <strong>å¦</strong>ï¼ˆåªè¯»ï¼Œæ— å®³ï¼‰
- æ¸…ç©ºå†…å­˜ â†’ <strong>æ˜¯</strong>ï¼ˆä¼šç ´åå…¶ä»–ç¨‹åºæ•°æ®ï¼‰
- æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤ â†’ <strong>å¦</strong>ï¼ˆè¿™æ˜¯ç”¨æˆ·è¿›å…¥å†…æ ¸çš„åˆæ³•å…¥å£ï¼‰
- å…³é—­ä¸­æ–­ â†’ <strong>æ˜¯</strong>ï¼ˆå¯èƒ½å¯¼è‡´ç³»ç»Ÿæ— æ³•å“åº”ï¼‰
- ä¿®æ”¹è®¾å¤‡çŠ¶æ€è¡¨ â†’ <strong>æ˜¯</strong>ï¼ˆç›´æ¥å½±å“ç¡¬ä»¶ï¼‰
- è®¿é—® I/O è®¾å¤‡ â†’ <strong>æ˜¯</strong>ï¼ˆå¿…é¡»ç”±å†…æ ¸ç»Ÿä¸€ç®¡ç†ï¼‰</p>
</blockquote>
<p>è¿™ä¸ªé—®é¢˜å®Œç¾æ£€éªŒäº†ä½ å¯¹ <strong>â€œç”¨æˆ·æ€/å†…æ ¸æ€â€</strong> å’Œ <strong>â€œä¿æŠ¤â€</strong> æ¦‚å¿µçš„ç†è§£ã€‚</p>
<h2 id="lec6">lec6</h2>
<p><img alt="divide" src="../imgs/lec6-divide.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["content.action.edit", "navigation.tracking", "navigation.expand", "navigation.top", "navigation.footer"], "search": "../../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>